<!DOCTYPE html>
<html 
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/mainLayout}">
<section layout:fragment="content" class="contents d-flex justify-content-center">
	<div class="w-75 bg-light my-5 d-flex">
		<!-- 상품 대표 이미지 -->
		<div class="col-6 bg-success">
			<div class="d-flex justify-content-center">
				<img th:src="${item.imagePath}" alt="본문 이미지" width="400px">	
			</div>	
		</div>
		
		<!-- 상품 설명 & 옵션 -->
		<div class="col-6">
			<h3 th:text="${item.name}"></h3>
			<hr>
			<table class="table table-borderless">
					<tr>
						<th>PRICE</th>
						<td th:text="${item.price}" style="text-decoration: line-through;"></td>
					</tr>
					<tr>
						<th>SALE</th>
						<td th:text="${item.sale}"></td>
					</tr>
					<tr>
						<th>OPTION</th>
						<td>
							<select id="option" class="form-control col-8" >
					            <option>-[필수] OPTION 선택-</option>
					            <option th:each="option : ${optionList}" th:value="|${option.color} - ${option.size}|" th:text="|${option.color} - ${option.size}|">
					            </option>					          
					        </select>
						</td>						
					</tr>					
			</table>			
			<input type="hidden" th:value="${item.name}" id="name">
			<input type="hidden" th:value="${item.sale}" id="sale">
			<table id="orderTable" class="table"> 
				<tbody>
					
				</tbody>			
			</table>
		
			
			<div>Total Price: </div>
			
			<!--  order / cart / wish button --> 
			<div class="d-flex mt-3">
				<div class="col-4">
					<a href="/shop/order/main-view"><button class="order btn btn-dark w-100">ORDER</button></a>
				</div>
				<div class="col-4">
					<a href="/shop/cart/main-view"><button class="cart btn btn-light w-100">CART</button></a>
				</div>
				<div class="col-4">
					<a th:href="|/shop/user/mypage/wish?userId=${userId}|"><button class="wish btn btn-light w-100" th:if="|${userId != null}|">WISH</button></a>
				</div>		
			</div>		
		</div>
	
	</div>
</section>

<th:block layout:fragment="script">
    <script>
    
    	$(document).ready(function(){
			
    		// 상품 정보 가져오기
    		$("#option").on('change',function(){
    			
    			let option = $("select option:selected").val();    			
    			let name = $("#name").val();
    			let sale = $("#sale").val();
    			
    			let newRow = $('<tr>')
    				.append('<td>'+name+'</td>')
    				.append('<td>'+option+'</td>')
    				.append('<td><input type="number" min="1"  max="10" step="1" value="1" id="itemStock"/>'+'</td>')
    				.append('<td>'+sale+'</td>')
    				.append('<td><button class="btn btn-light">삭제</button></td>')
    				
    			$("#orderTable tbody").append(newRow);

    		}); // ------ 끝
    		
    		    		
    		// order
    		$(".order").on('click',function() {
    			
   			  $('#orderTable tr').each(function() {
   				      let name = $(this).find("td").eq(0).html();  
   				      let option = $(this).find("td").eq(1).html();
   				      let count = $(this).find("td").find("#itemStock").val();   				      
   				      let sale = $(this).find("td").eq(3).html();

   				      $.ajax({
   				    	  type: "post"
   				    	  ,url: "/shop/order/order"
   				    	  ,data: {"name":name, "option":option, "count":count, "sale" : sale}
   				      
   				      	  ,success:function(data) {
   				      		  if (data.code == 200) {
   				      			  
   				      		  }
   				      	  }
   				      	  
   				    	  
   				      });
   				  });
    		}); // ------ order 끝
    		
    	}); // -------- document 끝
    		
 

    </script>
</th:block>